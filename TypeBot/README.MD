<h1 align="center">üöÄ Instala√ß√£o e configura√ß√£o do TypeBot üöÄ</h1> 

# üí° Overview

- üî• O processo de configura√ß√£o do servi√ßo em si √© complexo, ent√£o deixei alguns links para consulta que n√£o devem ser ignorados
- üõ†Ô∏è Utilize as consultas caso algo falhe ou deseje implementar mais recursos

## Links

- ‚û°Ô∏è Typebot N√£o Faz Login - Corrigindo o Erro de Login no Typebot
    - ‚û°Ô∏è Este video esclarece algumas situa√ß√µes de login, e algumas configura√ßoes visuais do docker-compose.yml
    - ‚û°Ô∏è Pude ver no v√≠deo algumas coisas interessantes como logins e confirua√ß√£o do minio em docker compose
    - ‚û°Ô∏è https://www.youtube.com/watch?v=l1ZLESl6rnk





## Fluxo

- ‚û°Ô∏è Acesse o container no VSCODE abra um terminal e siga o processo
- ‚û°Ô∏è Configura√ß√£o do Typebot
- ‚û°Ô∏è O diret√≥rio /opt √© utilizado para software e aplica√ß√µes adicionais que n√£o fazem parte do sistema padr√£o. 
- ‚û°Ô∏è Crie um Diret√≥rio para o Typebot: 

``` bash
sudo mkdir -p /opt/docker/typebot
```

- ‚û°Ô∏è Permiss√µes do usuario sysadmin na pasta para altera√ß√µes:

```bash
sudo chown -R sysadmin:sysadmin /opt/docker
```

```bash
sudo chmod -R 755 /opt/docker
```


- ‚û°Ô∏è V√° at√© a pasta criada:

``` bash
cd /opt/docker/typebot
```

- ‚û°Ô∏è Baixe os Arquivos Necess√°rios:

```bash
sudo wget https://raw.githubusercontent.com/baptisteArno/typebot.io/latest/docker-compose.yml
```
```bash
sudo wget https://raw.githubusercontent.com/baptisteArno/typebot.io/latest/.env.example -O .env
```
- ‚û°Ô∏è OBSERVA√á√ÉO**** 
    - ‚û°Ô∏è Instalei uma nova vers√£o em teoria 3.8 do link acima, o arquivo docker compose.yml √© simples
    - ‚û°Ô∏è Com a ajuda do chatgpt configuramos o arquivo novamente, use esse codigo para passar do login que estava dando erro.
    - ‚û°Ô∏è Nesse arquivo consta vari√°veis que funcionam corretamente para o acesso aos postgres e redis
    - ‚û°Ô∏è Em teoria o arquivo que vem √© so de exemplo e se espera que fa√ßamos altera√ß√µes necessarias
```bash
version: '3.8'

x-typebot-common: &typebot-common
  restart: always
  depends_on:
    typebot-redis:
      condition: service_healthy
    typebot-db:
      condition: service_healthy
  networks:
    - typebot-network
  env_file: .env
  environment:
    REDIS_URL: redis://typebot-redis:6379
    DATABASE_URL: postgresql://typebot:typebot@typebot-db:5432/typebot

services:
  typebot-db:
    image: postgres:16
    restart: always
    volumes:
      - db-data:/var/lib/postgresql/data
    environment:
      - POSTGRES_DB=typebot
      - POSTGRES_USER=typebot
      - POSTGRES_PASSWORD=typebot
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U typebot"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - typebot-network

  typebot-redis:
    image: redis:alpine
    restart: always
    command: --save 60 1 --loglevel warning
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      start_period: 20s
      interval: 30s
      retries: 5
      timeout: 3s
    volumes:
      - redis-data:/data
    networks:
      - typebot-network

  typebot-builder:
    <<: *typebot-common
    image: baptistearno/typebot-builder:latest
    ports:
      - '3000:3000'

  typebot-viewer:
    <<: *typebot-common
    image: baptistearno/typebot-viewer:latest
    ports:
      - '3001:3000'

networks:
  typebot-network:
    driver: bridge

volumes:
  db-data:
  redis-data:
```

- ‚û°Ô∏è OBSERVA√á√ÉO****
  - ‚û°Ô∏è Arquivo .env que esta funcionando, usar esse mas mudar a ENCRYPTION_SECRET caso refa√ßa a instala√ß√£o
  
```bash
# Chave de Criptografia (32 caracteres aleat√≥rios)
ENCRYPTION_SECRET=MZ9oVh4R/ioLMVmnN11wKs9pox4445cx

# Configura√ß√£o do Banco de Dados (PostgreSQL)
DATABASE_URL=postgresql://postgres:typebot@typebot-db:5432/typebot

# Op√ß√µes do Node.js
NODE_OPTIONS=--no-node-snapshot

# URLs do Typebot (corretamente mapeadas para as portas 8080 e 8081)
NEXTAUTH_URL=http://agetechsolutions.duckdns.org:3000
NEXT_PUBLIC_VIEWER_URL=http://agetechsolutions.duckdns.org:3001

# E-mail de Administrador (para receber notifica√ß√µes ou autenticar-se)
ADMIN_EMAIL=solutionsagetech@gmail.com

# Configura√ß√£o do Servidor SMTP (Gmail)
EMAIL_SERVER=smtp://solutionsagetech%40gmail.com:eizs aonn tqni xezh@smtp.gmail.com:587
EMAIL_FROM="Typebot <solutionsagetech@gmail.com>"

# Desativar cadastro de novos usu√°rios
# Ou seja, no primeiro cadastro devemos mentar como false para que o admin consiga entrar
# Depois desabilitamos as dockers alteramos pra true e subimos as dockers novamente
DISABLE_SIGNUP=false

# Configura√ß√£o de Seguran√ßa do SMTP
SMTP_USERNAME=solutionsagetech@gmail.com
SMTP_PASSWORD=eizs aonn tqni xezh
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
NEXT_PUBLIC_SMTP_FROM="Typebot <solutionsagetech@gmail.com>"
SMTP_SECURE=false


S3_ENDPOINT=http://agetechsolutions.duckdns.org:9000
S3_ACCESS_KEY=admin
S3_SECRET_KEY=Sysadmin##
S3_BUCKET=images-bot
S3_REGION=us-east-1
S3_FORCE_PATH_STYLE=true





# Outras Configura√ß√µes Relevantes (se aplic√°vel)
NEXT_PUBLIC_DISABLE_SIGNUP=true  # Se quiser desativar o cadastro de novos usu√°rios
```

- ‚û°Ô∏è Gere uma Chave Secreta de 32 Caracteres:
- ‚û°Ô∏è Copie a chave pois vamos usar a mesma no arquivo .env
- ‚û°Ô∏è A chave encriptada esta no diretorio do drive pasta da empresa AgetechSolutions

```bash
openssl rand -base64 24 | tr -d '\n' ; echo
```

- ‚û°Ô∏è No vscode abra a pasta typebot, e clique no arquivo .env
- ‚û°Ô∏è A configura√ß√£o padr√£o √© muito simples, ent√£o foi alterada; copie cole o exemplo abaixo e fa√ßa as altera√ß√µes necess√°rias:
- ‚û°Ô∏è **Observa√ß√£o:** Vamos usar as portas 3000 e 3001
    - ‚û°Ô∏è Lembrando que temos que tamb√©m configurar o firewall para acesso as portas
    - ‚û°Ô∏è Configurar tamb√©m o arquivo docker-compose.yml para n√£o gerar erros
- ‚û°Ô∏è No arquivo que segue abaixo mude essa linha para o primeiro login do admin
    - ‚û°Ô∏è DISABLE_SIGNUP=true - coloque como false, salve e suba as dockers
    - ‚û°Ô∏è Depois do primeiro login do admin mude novamente para true, salve derrube as dockers e suba novamente.




```bash
# Chave de Criptografia (32 caracteres aleat√≥rios)
ENCRYPTION_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# Configura√ß√£o do Banco de Dados (PostgreSQL)
DATABASE_URL=postgresql://postgres:typebot@typebot-db:5432/typebot

# Op√ß√µes do Node.js
NODE_OPTIONS=--no-node-snapshot

# URLs do Typebot (corretamente mapeadas para as portas 8080 e 8081)
NEXTAUTH_URL=http://agetech.duckdns.org:3000
NEXT_PUBLIC_VIEWER_URL=http://agetech.duckdns.org:3001

# E-mail de Administrador (para receber notifica√ß√µes ou autenticar-se)
ADMIN_EMAIL=solutionsagetech@gmail.com

# Configura√ß√£o do Servidor SMTP (Gmail)
EMAIL_SERVER=smtp://solutionsagetech%40gmail.com:xxxx xxxx xxxx xxxx@smtp.gmail.com:587
EMAIL_FROM="Typebot <solutionsagetech@gmail.com>"

# Desativar cadastro de novos usu√°rios
# Ou seja, no primeiro cadastro devemos mentar como false para que o admin consiga entrar
# Depois desabilitamos as dockers alteramos pra true e subimos as dockers novamente
DISABLE_SIGNUP=true

# Configura√ß√£o de Seguran√ßa do SMTP
SMTP_USERNAME=solutionsagetech@gmail.com
SMTP_PASSWORD=xxxx xxxx xxxx xxxx
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
NEXT_PUBLIC_SMTP_FROM="Typebot <solutionsagetech@gmail.com>"
SMTP_SECURE=false

# Outras Configura√ß√µes Relevantes (se aplic√°vel)
NEXT_PUBLIC_DISABLE_SIGNUP=true  # Se quiser desativar o cadastro de novos usu√°rios
```

- ‚û°Ô∏è Para mais detalhes sobre outras op√ß√µes de autentica√ß√£o, consulte a documenta√ß√£o oficial.
- ‚û°Ô∏è https://docs.typebot.io/self-hosting/configuration
- ‚û°Ô∏è Dentro da pasta do typebot existe um arquivo chamado docker-compose.yml
- ‚û°Ô∏è Abra o arquivo no vscode e altere as portas mencionadas acima que ser√£o 3000 e 3001

```bash
version: '3.3'

volumes:
  db-data:

services:
  typebot-db:
    image: postgres:16
    restart: always
    volumes:
      - db-data:/var/lib/postgresql/data
    environment:
      - POSTGRES_DB=typebot
      - POSTGRES_PASSWORD=typebot
    healthcheck:
        test: ["CMD-SHELL", "pg_isready -U postgres"]
        interval: 5s
        timeout: 5s
        retries: 5
  typebot-builder:
    image: baptistearno/typebot-builder:latest
    restart: always
    depends_on:
      typebot-db:
        condition: service_healthy
    ports:
      - '3000:3000'
    extra_hosts:
      - 'host.docker.internal:host-gateway'
    env_file: .env

  typebot-viewer:
    image: baptistearno/typebot-viewer:latest
    depends_on:
      typebot-db:
        condition: service_healthy
    restart: always
    ports:
      - '3001:3000'
    env_file: .env
```

- ‚û°Ô∏è Abra as portas no firewall do servidor e do modem utilizado (vivo, tim ou claro)
- ‚û°Ô∏è Crie as regras no modem das portas 3000 e 3001
- ‚û°Ô∏è Se tudo estiver correto agora vamos subir o docker compose:
- ‚û°Ô∏è Dentro da pasta /opt/docker/typebot execute o comando:

```bash
sudo docker compose up -d
```

- ‚û°Ô∏è Se precisar baixar o docker:
- ‚û°Ô∏è A documenta√ß√£o aconselha sempre baixar o docker e atualizar, ou seja, ele deleta as imagens e faz o pull novamente
- ‚û°Ô∏è Em teoria nunca se perde os fluxos, mas melhor testar antes

```bash
sudo docker compose down --remove-orphans
sudo docker compose pull typebot-builder
sudo docker compose pull typebot-viewer
sudo docker compose up -d
```

- ‚û°Ô∏è Verificando o servi√ßo em execu√ß√£o

```bash
sudo docker ps -a
```

- ‚û°Ô∏è Acesse o typebot atrav√©s da url:
- ‚û°Ô∏è http://agetech.duckdns.org:3000/
- ‚û°Ô∏è Sera solicitado o email para entrar: use o email que esta configurado no arquivo .env
- ‚û°Ô∏è Uma chave de acesso sera enviada para o email padr√£o.

---

## Considera√ß√µes Adicionais 
- ‚û°Ô∏è *** Verificar essa op√ß√£o para SSL (https) quando for migrar ele para acesso externo.
Proxy Reverso e SSL: Para produ√ß√£o, √© recomend√°vel configurar um proxy reverso (como Nginx ou Traefik) e habilitar SSL/TLS para seguran√ßa. Isso permitir√° que voc√™ acesse o Typebot via HTTPS e em portas padr√£o (80/443).

- ‚û°Ô∏è Armazenamento de Dados: Os dados do Typebot s√£o armazenados no diret√≥rio .typebot dentro do diret√≥rio de instala√ß√£o. Certifique-se de configurar backups regulares para evitar perda de dados.


### Crie um snapshot ate aqui com a instala√ß√£o do typebot para seguran√ßa.

- ‚û°Ô∏è Configura√ß√£o bem sucedida, volte a home e continue o tutorial
- [Home](/README.md)